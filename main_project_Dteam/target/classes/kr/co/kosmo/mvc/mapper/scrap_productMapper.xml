<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="scarp_Product">
	<select id="recommend" resultType="int" parameterType="int">
		select pro_num from (
		select pro_num,count(pro_num) from (
		select s.pro_num FROM SCRAP_PRODUCT s,product p where s.pro_num=p.pro_num and p.pro_category=#{cateNum} ORDER BY scr_num DESC
		) where rownum between 1 and 200 group by pro_num order by count(pro_num) desc
		)
		where rownum between 1 and 4 
	</select>
	
	<!-- 오원석 상품스크랩 -->
	<select id="getlist" parameterType="int" resultMap="ScrapProductMap">
		select * from scrap_product s,product p where s.mem_num = #{mem_num} and p.pro_num = s.pro_num
	</select>
	
	<resultMap type="scrprovo" id="ScrapProductMap">
		<id property="scr_num" column="scr_num"/>
		<result property="pro_num" column="pro_num"/>
		<result property="mem_num" column="mem_num"/>
		<association property="productVO" column="provo">
			<id property="pro_num" column="pro_num"/>
			<result property="pro_name" column="pro_name"/>
			<result property="pro_price" column="pro_price"/>
			<result property="pro_discount" column="pro_discount"/>
			<result property="pro_thumb" column="pro_thumb"/>
		</association>
	</resultMap>
	
	<insert id="scrap" parameterType="scrprovo">
		insert into scrap_product values(SCRAP_SEQ.nextval, #{mem_num}, #{pro_num})
	</insert>

	<select id="scrapchk" parameterType="scrprovo" resultType="int">
		select count(*) cnt from scrap_product where mem_num=#{mem_num} and pro_num=#{pro_num}
	</select>

	<delete id="scrapdel" parameterType="scrprovo">
		delete from scrap_product where mem_num=#{mem_num} and pro_num=#{pro_num}
	</delete>
</mapper>